version: '3.8'
services:
  transmission:
    image: index.docker.io/haugene/transmission-openvpn
    container_name: transmission
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun
    restart: unless-stopped
    volumes:
      # ssd
      - /etc/localtime:/etc/localtime:ro
      - ${DOCKER_DIR}/transmission/data:/data
      - ${INCOMPLETE_DIR}/torrent:/incomplete
      # hdd
      - ${MOUNT_POINT}/data_root/transmission:/data_root/transmission
      - ${MOUNT_POINT}/media/films:/films
      - ${MOUNT_POINT}/media/shows:/shows
    environment:
      - OPENVPN_PROVIDER=NORDVPN
      - OPENVPN_USERNAME=${OPENVPN_USERNAME}
      - OPENVPN_PASSWORD=${OPENVPN_PASSWORD}
      - NORDVPN_COUNTRY=GB
      - NORDVPN_CATEGORY=legacy_p2p
      - NORDVPN_PROTOCOL=udp
      - OPENVPN_OPTS=--inactive 3600 --ping 10 --ping-exit 60
      - TRANSMISSION_WATCH_DIR_ENABLED=false
      - TRANSMISSION_INCOMPLETE_DIR_ENABLED=true
      - TRANSMISSION_INCOMPLETE_DIR=/incomplete
      - TRANSMISSION_DOWNLOAD_DIR=/data_root/transmission/complete
      - TRANSMISSION_PREALLOCATION=2
      - TRANSMISSION_RATIO_LIMIT_ENABLED=true
      - TRANSMISSION_SCRAPE_PAUSED_TORRENTS_ENABLED=false
      - TRANSMISSION_RPC_AUTHENTICATION_REQUIRED=true
      - TRANSMISSION_RPC_USERNAME=${TRANSMISSION_RPC_USERNAME}
      - TRANSMISSION_RPC_PASSWORD=${TRANSMISSION_RPC_PASSWORD}
      - TRANSMISSION_DOWNLOAD_QUEUE_ENABLED=false
      - LOCAL_NETWORK=${LOCAL_NETWORK}
      - PUID=1000
      - PGID=1002
    ports:
      - "127.0.0.1:9091:9091"
    networks:
      - download
#  proxy:
#    image: index.docker.io/haugene/transmission-openvpn-proxy
#    container_name: proxy
#    ports:
#      - 127.0.0.1:8282:8080
#    volumes:
#      - /etc/localtime:/etc/localtime:ro
#    networks:
#      - download
#    restart: unless-stopped
networks:
  download:
    name: download
